<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply for Permit</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<script>
        // Filter duration options based on selected category
        function updateDurationOptions() {
            const category = document.getElementById('permit_category').value;
            const durationSelect = document.getElementById('permit_type_key');
            const allOptions = durationSelect.querySelectorAll('option[data-category]');
            
            // Hide all options first
            allOptions.forEach(option => {
                option.style.display = 'none';
                option.disabled = true;
            });
            
            // Show only options for selected category
            if (category) {
                const matchingOptions = durationSelect.querySelectorAll(`option[data-category="${category}"]`);
                matchingOptions.forEach(option => {
                    option.style.display = 'block';
                    option.disabled = false;
                });
                durationSelect.disabled = false;
            } else {
                durationSelect.disabled = true;
            }
            
            // Reset duration selection
            durationSelect.value = '';
        }
        
        // Initialize on page load
        window.onload = function() {
            document.getElementById('permit_type_key').disabled = true;
        };
    </script>

<body>
    <div class="container">
        <header>
            <a href="{{ url_for('view_permit') }}" class="back-link">← Back</a>
            <h1>Apply for Permit</h1>
        </header>

        <main>
            {% if error %}
                <div class="error-message">
                    <p>⚠️ {{ error }}</p>
                </div>
            {% endif %}

            <form method="POST" action="{{ url_for('apply_permit') }}">
                <div class="form-group">
                    <label for="vehicle_key">Select Vehicle: </label>
                    <select id="vehicle_key" name="vehicle_key" required>
                        <option value="">-- Choose a Vehicle --</option>
                        {% for vehicle in vehicles %}
                        <option value="{{ vehicle[0] }}">
                            {{ vehicle[1] }} - {{ vehicle[2] }} {{ vehicle[3] }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="permit_category">Permit Category: </label>
                    <select id="permit_category" name="permit_category" required onchange="updateDurationOptions()">
                        <option value="">-- Choose Category --</option>
                        <option value="Faculty">Faculty</option>
                        <option value="On-Campus Student">On-Campus Student</option>
                        <option value="Off-Campus Student">Off-Campus Student</option>
                        <option value="Guest">Guest</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="permit_type_key">Permit Duration:</label>
                    <select id="permit_type_key" name="permit_type_key" required disabled>
                        <option value="">-- Select Duration --</option>
                        {% for permit_type in permit_types %}
                        <option value="{{ permit_type[0] }}" data-category="{{ permit_type[1] }}" style="display:none;" disabled>
                            {{ permit_type[2] }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-actions">
                    <button type="submit" class="primary-btn">Submit Application</button>
                    <button type="button" class="secondary-btn" onclick="window.location.href='{{ url_for('view_permit') }}'">Cancel</button>
                </div>
            </form>
        </main>
    </div>
</body>
</html>